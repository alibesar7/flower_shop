name: Validate PR Title

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  validate-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title format
        uses: actions/github-script@v6
        with:
          script: |
            const prTitle = context.payload.pull_request.title;
            /*
              Format:
              type(scope): TICKET-task-name

              Example:
              feat(ECOM-27): ECOM-27-initialize-project
            */
            const pattern = /^(fix|release|feat|hotfix|build|test)\((JIRA-\d+|[A-Z]+-\d+)\):\s\2-[a-zA-Z0-9-]+$/;

            if (!pattern.test(prTitle)) {
              core.setFailed(
                '❌ Invalid PR title: "' + prTitle + '"\n\n' +
                'Expected format:\n' +
                'type(scope): TICKET-task-name\n\n' +
                'Allowed types: fix, release, feat, hotfix, build, test\n' +
                'Allowed scopes: JIRA-<number> or PROJECT-<number>\n\n' +
                'Example:\n' +
                'feat(ECOM-27): ECOM-27-initialize-project'
              );
            } else {
              console.log('✅ PR title is valid:', prTitle);
            }
